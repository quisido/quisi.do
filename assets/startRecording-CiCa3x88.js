import{c as X,t as w,d as L,e as R,g as I,N as S,f as q,h as J,k as ht,l as mt,n as C,m as D,R as gt,A as St,s as z,C as K,o as Tt,p as Et,q as B,r as yt,v as Nt,w as j,x as wt,y as It,P as Mt,z as bt,B as Ct,D as Z,F as Q,G as tt,H as v,J as Rt,K as xt,M as vt,O as V,Q as _t,S as Dt,T as At,U as Lt,V as Ot,W as zt,X as Vt,Y as kt,Z as Pt,$ as Ft,a0 as Ut,a1 as Bt,a2 as Ht,a3 as Gt,a4 as Wt}from"./index-CuqHnTnh.js";const N={FullSnapshot:2,IncrementalSnapshot:3,Meta:4,Focus:6,ViewEnd:7,VisualViewport:8,FrustrationRecord:9},b={Document:0,DocumentType:1,Element:2,Text:3,CDATA:4,DocumentFragment:11},T={Mutation:0,MouseMove:1,MouseInteraction:2,Scroll:3,ViewportResize:4,Input:5,TouchMove:6,MediaInteraction:7,StyleSheetRule:8},E={MouseUp:0,MouseDown:1,Click:2,ContextMenu:3,DblClick:4,Focus:5,Blur:6,TouchStart:7,TouchEnd:9},H={Play:0,Pause:1};function et(t){return!!t.changedTouches}function _(t){return t.composed===!0&&X(t.target)?t.composedPath()[0]:t.target}const G=25;function $t(t){return Math.abs(t.pageTop-t.offsetTop-window.scrollY)>G||Math.abs(t.pageLeft-t.offsetLeft-window.scrollX)>G}const Yt=(t,n)=>{const e=window.visualViewport,o={layoutViewportX:t,layoutViewportY:n,visualViewportX:t,visualViewportY:n};if(e)$t(e)?(o.layoutViewportX=Math.round(t+e.offsetLeft),o.layoutViewportY=Math.round(n+e.offsetTop)):(o.visualViewportX=Math.round(t-e.offsetLeft),o.visualViewportY=Math.round(n-e.offsetTop));else return o;return o},nt=t=>({scale:t.scale,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,pageLeft:t.pageLeft,pageTop:t.pageTop,height:t.height,width:t.width});function y(t,n){return{data:{source:t,...n},type:N.IncrementalSnapshot,timestamp:w()}}const Xt=50;function qt(t,n,e){const{throttled:o,cancel:s}=L(r=>{const u=_(r),a=n.nodeIds.get(u);if(a===void 0)return;const c=st(r);if(!c)return;const d={id:a,timeOffset:0,x:c.x,y:c.y};e(y(et(r)?T.TouchMove:T.MouseMove,{positions:[d]}))},Xt,{trailing:!1}),{stop:i}=R(t,document,["mousemove","touchmove"],o,{capture:!0,passive:!0});return{stop:()=>{i(),s()}}}function st(t){let{clientX:n,clientY:e}=et(t)?t.changedTouches[0]:t;if(window.visualViewport){const{visualViewportX:o,visualViewportY:s}=Yt(n,e);n=o,e=s}if(!(!Number.isFinite(n)||!Number.isFinite(e)))return{x:n,y:e}}const W={pointerup:E.MouseUp,mousedown:E.MouseDown,click:E.Click,contextmenu:E.ContextMenu,dblclick:E.DblClick,focus:E.Focus,blur:E.Blur,touchstart:E.TouchStart,touchend:E.TouchEnd};function Jt(t,n,e,o){const s=i=>{const r=_(i),u=n.nodeIds.get(r);if(u===void 0||I(r,t.defaultPrivacyLevel)===S.HIDDEN)return;const a=W[i.type];let c;if(a!==E.Blur&&a!==E.Focus){const l=st(i);if(!l)return;c={id:u,type:a,x:l.x,y:l.y}}else c={id:u,type:a};const d={id:o.getIdForEvent(i),...y(T.MouseInteraction,c)};e(d)};return R(t,document,Object.keys(W),s,{capture:!0,passive:!0})}const Kt=100;function ot(t,n,e,o,s=document){const{throttled:i,cancel:r}=L(a=>{const c=_(a);if(!c)return;const d=n.nodeIds.get(c);if(d===void 0||I(c,t.defaultPrivacyLevel)===S.HIDDEN)return;const l=c===document?{scrollTop:q(),scrollLeft:J()}:{scrollTop:Math.round(c.scrollTop),scrollLeft:Math.round(c.scrollLeft)};o.set(c,l),e(y(T.Scroll,{id:d,x:l.scrollLeft,y:l.scrollTop}))},Kt),{stop:u}=ht(t,s,"scroll",i,{capture:!0,passive:!0});return{stop:()=>{u(),r()}}}const jt=200;function Zt(t,n){const e=mt(t).subscribe(o=>{n(y(T.ViewportResize,o))});return{stop:()=>{e.unsubscribe()}}}function Qt(t,n){const e=window.visualViewport;if(!e)return{stop:C};const{throttled:o,cancel:s}=L(()=>{n({data:nt(e),type:N.VisualViewport,timestamp:w()})},jt,{trailing:!1}),{stop:i}=R(t,e,["resize","scroll"],o,{capture:!0,passive:!0});return{stop:()=>{i(),s()}}}function te(t,n,e){return R(t,document,["play","pause"],o=>{const s=_(o);if(!s)return;const i=n.nodeIds.get(s);i===void 0||I(s,t.defaultPrivacyLevel)===S.HIDDEN||e(y(T.MediaInteraction,{id:i,type:o.type==="play"?H.Play:H.Pause}))},{capture:!0,passive:!0})}function ee(t,n){function e(i,r){if(!i||!i.ownerNode)return;const u=t.nodeIds.get(i.ownerNode);u!==void 0&&r(u)}const o=[D(CSSStyleSheet.prototype,"insertRule",({target:i,parameters:[r,u]})=>{e(i,a=>n(y(T.StyleSheetRule,{id:a,adds:[{rule:r,index:u}]})))}),D(CSSStyleSheet.prototype,"deleteRule",({target:i,parameters:[r]})=>{e(i,u=>n(y(T.StyleSheetRule,{id:u,removes:[{index:r}]})))})];typeof CSSGroupingRule<"u"?s(CSSGroupingRule):(s(CSSMediaRule),s(CSSSupportsRule));function s(i){o.push(D(i.prototype,"insertRule",({target:r,parameters:[u,a]})=>{e(r.parentStyleSheet,c=>{const d=$(r);d&&(d.push(a||0),n(y(T.StyleSheetRule,{id:c,adds:[{rule:u,index:d}]})))})}),D(i.prototype,"deleteRule",({target:r,parameters:[u]})=>{e(r.parentStyleSheet,a=>{const c=$(r);c&&(c.push(u),n(y(T.StyleSheetRule,{id:a,removes:[{index:c}]})))})}))}return{stop:()=>{o.forEach(i=>i.stop())}}}function $(t){const n=[];let e=t;for(;e.parentRule;){const r=Array.from(e.parentRule.cssRules).indexOf(e);n.unshift(r),e=e.parentRule}if(!e.parentStyleSheet)return;const s=Array.from(e.parentStyleSheet.cssRules).indexOf(e);return n.unshift(s),n}function ne(t,n){return R(t,window,["focus","blur"],()=>{n({data:{has_focus:document.hasFocus()},type:N.Focus,timestamp:w()})})}function se(t,n,e){const o=t.subscribe(12,s=>{var i,r;s.rawRumEvent.type===gt.ACTION&&s.rawRumEvent.action.type===St.CLICK&&(!((r=(i=s.rawRumEvent.action.frustration)===null||i===void 0?void 0:i.type)===null||r===void 0)&&r.length)&&"events"in s.domainContext&&s.domainContext.events&&s.domainContext.events.length&&n({timestamp:s.rawRumEvent.date,type:N.FrustrationRecord,data:{frustrationTypes:s.rawRumEvent.action.frustration.type,recordIds:s.domainContext.events.map(u=>e.getIdForEvent(u))}})});return{stop:()=>{o.unsubscribe()}}}function oe(t,n){const e=t.subscribe(5,()=>{n({timestamp:w(),type:N.ViewEnd})});return{stop:()=>{e.unsubscribe()}}}function k(t,n){const e=t.tagName,o=t.value;if(z(t,n)){const s=t.type;return e==="INPUT"&&(s==="button"||s==="submit"||s==="reset")?o:!o||e==="OPTION"?void 0:K}if(e==="OPTION"||e==="SELECT")return t.value;if(!(e!=="INPUT"&&e!=="TEXTAREA"))return o}const re=/url\((?:(')([^']*)'|(")([^"]*)"|([^)]*))\)/gm,ie=/^[A-Za-z]+:|^\/\//,ae=/^["']?data:.*,/i;function ue(t,n){return t.replace(re,(e,o,s,i,r,u)=>{const a=s||r||u;if(!n||!a||ie.test(a)||ae.test(a))return e;const c=o||i||"";return`url(${c}${ce(a,n)}${c})`})}function ce(t,n){try{return Tt(t,n).href}catch{return t}}const de=/[^a-z1-6-_]/;function rt(t){const n=t.toLowerCase().trim();return de.test(n)?"div":n}function Y(t,n){return`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='${t}' height='${n}' style='background-color:silver'%3E%3C/svg%3E`}function it(t){if(!(t===void 0||t.length===0))return t.map(n=>{const e=n.cssRules||n.rules;return{cssRules:Array.from(e,i=>i.cssText),disabled:n.disabled||void 0,media:n.media.length>0?Array.from(n.media):void 0}})}const le=1e6;function at(t,n,e,o){if(n===S.HIDDEN)return null;const s=t.getAttribute(e),i=t.tagName;if(Et(i,e,s,n,o)){if(i==="IMG"){const r=t;if(r.naturalWidth>0)return Y(r.naturalWidth,r.naturalHeight);const{width:u,height:a}=t.getBoundingClientRect();return u>0||a>0?Y(u,a):B}return i==="SOURCE"?B:K}return!s||typeof s!="string"?s:yt(s,le)}function P(){return{cssText:{count:0,max:0,sum:0},serializationDuration:{count:0,max:0,sum:0}}}function A(t,n,e){t[n].count+=1,t[n].max=Math.max(t[n].max,e),t[n].sum+=e}function fe(t,n){for(const e of["cssText","serializationDuration"])t[e].count+=n[e].count,t[e].max=Math.max(t[e].max,n[e].max),t[e].sum+=n[e].sum}function pe(t,n,e){if(n===S.HIDDEN)return{};const o={},s=rt(t.tagName),i=t.ownerDocument;for(let d=0;d<t.attributes.length;d+=1){const f=t.attributes.item(d).name,p=at(t,n,f,e.configuration);p!==null&&(o[f]=p)}if(t.value&&(s==="textarea"||s==="select"||s==="option"||s==="input")){const d=k(t,n);d!==void 0&&(o.value=d)}if(s==="option"&&n===S.ALLOW){const d=t;d.selected&&(o.selected=d.selected)}if(s==="link"){const d=Array.from(i.styleSheets).find(f=>f.href===t.href),l=O(d);l&&d&&(A(e.serializationContext.serializationStats,"cssText",l.length),o._cssText=l)}if(s==="style"&&t.sheet){const d=O(t.sheet);d&&(A(e.serializationContext.serializationStats,"cssText",d.length),o._cssText=d)}const r=t;if(s==="input"&&(r.type==="radio"||r.type==="checkbox")&&(n===S.ALLOW?o.checked=!!r.checked:z(r,n)&&delete o.checked),s==="audio"||s==="video"){const d=t;o.rr_mediaState=d.paused?"paused":"played"}let u,a;const c=e.serializationContext;switch(c.status){case 0:u=Math.round(t.scrollTop),a=Math.round(t.scrollLeft),(u||a)&&c.elementsScrollPositions.set(t,{scrollTop:u,scrollLeft:a});break;case 1:c.elementsScrollPositions.has(t)&&({scrollTop:u,scrollLeft:a}=c.elementsScrollPositions.get(t));break}return a&&(o.rr_scrollLeft=a),u&&(o.rr_scrollTop=u),o}function O(t){if(!t)return null;let n;try{n=t.rules||t.cssRules}catch{}if(!n)return null;const e=Array.from(n,Nt()?he:ut).join("");return ue(e,t.href)}function he(t){if(ge(t)&&t.selectorText.includes(":")){const n=/(\[[\w-]+[^\\])(:[^\]]+\])/g;return t.cssText.replace(n,"$1\\$2")}return ut(t)}function ut(t){return me(t)&&O(t.styleSheet)||t.cssText}function me(t){return"styleSheet"in t}function ge(t){return"selectorText"in t}function F(t,n,e){const o=Se(t,n,e);if(!o)return null;const s=e.scope.nodeIds.assign(t),i=o;return i.id=s,e.serializedNodeIds&&e.serializedNodeIds.add(s),i}function U(t,n,e){const o=[];return Q(t,s=>{const i=F(s,n,e);i&&o.push(i)}),o}function Se(t,n,e){switch(t.nodeType){case t.DOCUMENT_NODE:return Te(t,n,e);case t.DOCUMENT_FRAGMENT_NODE:return Ee(t,n,e);case t.DOCUMENT_TYPE_NODE:return ye(t);case t.ELEMENT_NODE:return Ne(t,n,e);case t.TEXT_NODE:return Ie(t,n);case t.CDATA_SECTION_NODE:return Me()}}function Te(t,n,e){return{type:b.Document,childNodes:U(t,n,e),adoptedStyleSheets:it(t.adoptedStyleSheets)}}function Ee(t,n,e){const o=Z(t);return o&&e.serializationContext.shadowRootsController.addShadowRoot(t),{type:b.DocumentFragment,childNodes:U(t,n,e),isShadowRoot:o,adoptedStyleSheets:o?it(t.adoptedStyleSheets):void 0}}function ye(t){return{type:b.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId}}function Ne(t,n,e){const o=rt(t.tagName),s=we(t)||void 0,i=wt(It(t),n);if(i===S.HIDDEN){const{width:a,height:c}=t.getBoundingClientRect();return{type:b.Element,tagName:o,attributes:{rr_width:`${a}px`,rr_height:`${c}px`,[bt]:Mt},childNodes:[],isSVG:s}}if(i===S.IGNORE)return;const r=pe(t,i,e);let u=[];return Ct(t)&&o!=="style"&&(u=U(t,i,e)),{type:b.Element,tagName:o,attributes:r,childNodes:u,isSVG:s}}function we(t){return t.tagName==="svg"||t instanceof SVGElement}function Ie(t,n){const e=j(t,n);if(e!==void 0)return{type:b.Text,textContent:e}}function Me(){return{type:b.CDATA,textContent:""}}function be(t,n,e,o){const s=w(),i=F(t,n.defaultPrivacyLevel,{serializationContext:o,configuration:n,scope:e});return A(o.serializationStats,"serializationDuration",tt(s,w())),i}function Ce(t){return{nodeIds:t}}function ct(t,n,e,o=document){const s=t.defaultPrivacyLevel,i=new WeakMap,r=o!==document,{stop:u}=R(t,o,r?["change"]:["input","change"],l=>{const f=_(l);(f instanceof HTMLInputElement||f instanceof HTMLTextAreaElement||f instanceof HTMLSelectElement)&&c(f)},{capture:!0,passive:!0});let a;if(r)a=C;else{const l=[v(HTMLInputElement.prototype,"value",c),v(HTMLInputElement.prototype,"checked",c),v(HTMLSelectElement.prototype,"value",c),v(HTMLTextAreaElement.prototype,"value",c),v(HTMLSelectElement.prototype,"selectedIndex",c)];a=()=>{l.forEach(f=>f.stop())}}return{stop:()=>{a(),u()}};function c(l){const f=I(l,s);if(f===S.HIDDEN)return;const p=l.type;let g;if(p==="radio"||p==="checkbox"){if(z(l,f))return;g={isChecked:l.checked}}else{const m=k(l,f);if(m===void 0)return;g={text:m}}d(l,g,n);const h=l.name;p==="radio"&&h&&l.checked&&document.querySelectorAll(`input[type="radio"][name="${CSS.escape(h)}"]`).forEach(m=>{m!==l&&d(m,{isChecked:!1},n)})}function d(l,f,p){const g=p.nodeIds.get(l);if(g===void 0)return;const h=i.get(l);(!h||h.text!==f.text||h.isChecked!==f.isChecked)&&(i.set(l,f),e(y(T.Input,{id:g,...f})))}}const Re=100,xe=16;function ve(t){let n=C,e=[];function o(){n(),t(e),e=[]}const{throttled:s,cancel:i}=L(o,xe,{leading:!1});return{addMutations:r=>{e.length===0&&(n=Rt(s,{timeout:Re})),e.push(...r)},flush:o,stop:()=>{n(),i()}}}function dt(t,n,e,o,s){const i=xt();if(!i)return{stop:C,flush:C};const r=ve(a=>{_e(a.concat(u.takeRecords()),t,n,e,o)}),u=new i(vt(r.addMutations));return u.observe(s,{attributeOldValue:!0,attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),{stop:()=>{u.disconnect(),r.stop()},flush:()=>{r.flush()}}}function _e(t,n,e,o,s){const i=new Map;t.filter(p=>p.type==="childList").forEach(p=>{p.removedNodes.forEach(g=>{lt(g,s.removeShadowRoot)})});const r=t.filter(p=>p.target.isConnected&&o.nodeIds.areAssignedForNodeAndAncestors(p.target)&&I(p.target,e.defaultPrivacyLevel,i)!==S.HIDDEN),u=P(),{adds:a,removes:c,hasBeenSerialized:d}=De(r.filter(p=>p.type==="childList"),e,o,u,s,i),l=Ae(r.filter(p=>p.type==="characterData"&&!d(p.target)),e,o,i),f=Le(r.filter(p=>p.type==="attributes"&&!d(p.target)),e,o,i);!l.length&&!f.length&&!c.length&&!a.length||n(y(T.Mutation,{adds:a,removes:c,texts:l,attributes:f}),u)}function De(t,n,e,o,s,i){const r=new Set,u=new Map;for(const h of t)h.addedNodes.forEach(m=>{r.add(m)}),h.removedNodes.forEach(m=>{r.has(m)||u.set(m,h.target),r.delete(m)});const a=Array.from(r);Oe(a);const c=new Set,d={status:2,serializationStats:o,shadowRootsController:s},l=[];for(const h of a){if(p(h))continue;const m=I(h.parentNode,n.defaultPrivacyLevel,i);if(m===S.HIDDEN||m===S.IGNORE)continue;const M=w(),x=F(h,m,{serializedNodeIds:c,serializationContext:d,configuration:n,scope:e});if(A(o,"serializationDuration",tt(M,w())),!x)continue;const pt=V(h);l.push({nextId:g(h),parentId:e.nodeIds.get(pt),node:x})}const f=[];return u.forEach((h,m)=>{const M=e.nodeIds.get(h),x=e.nodeIds.get(m);M!==void 0&&x!==void 0&&f.push({parentId:M,id:x})}),{adds:l,removes:f,hasBeenSerialized:p};function p(h){const m=e.nodeIds.get(h);return m!==void 0&&c.has(m)}function g(h){let m=h.nextSibling;for(;m;){const M=e.nodeIds.get(m);if(M!==void 0)return M;m=m.nextSibling}return null}}function Ae(t,n,e,o){var s;const i=[],r=new Set,u=t.filter(a=>r.has(a.target)?!1:(r.add(a.target),!0));for(const a of u){if(a.target.textContent===a.oldValue)continue;const d=e.nodeIds.get(a.target);if(d===void 0)continue;const l=I(V(a.target),n.defaultPrivacyLevel,o);l===S.HIDDEN||l===S.IGNORE||i.push({id:d,value:(s=j(a.target,l))!==null&&s!==void 0?s:null})}return i}function Le(t,n,e,o){const s=[],i=new Map,r=t.filter(a=>{const c=i.get(a.target);return c&&c.has(a.attributeName)?!1:(c?c.add(a.attributeName):i.set(a.target,new Set([a.attributeName])),!0)}),u=new Map;for(const a of r){if(a.target.getAttribute(a.attributeName)===a.oldValue)continue;const d=e.nodeIds.get(a.target);if(d===void 0)continue;const l=I(a.target,n.defaultPrivacyLevel,o),f=at(a.target,l,a.attributeName,n);let p;if(a.attributeName==="value"){const h=k(a.target,l);if(h===void 0)continue;p=h}else typeof f=="string"?p=f:p=null;let g=u.get(a.target);g||(g={id:d,attributes:{}},s.push(g),u.set(a.target,g)),g.attributes[a.attributeName]=p}return s}function Oe(t){t.sort((n,e)=>{const o=n.compareDocumentPosition(e);return o&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:o&Node.DOCUMENT_POSITION_CONTAINS||o&Node.DOCUMENT_POSITION_FOLLOWING?1:o&Node.DOCUMENT_POSITION_PRECEDING?-1:0})}function lt(t,n){X(t)&&n(t.shadowRoot),Q(t,e=>lt(e,n))}function ze(){const t=new WeakMap;return{set(n,e){n===document&&!document.scrollingElement||t.set(n===document?document.scrollingElement:n,e)},get(n){return t.get(n)},has(n){return t.has(n)}}}const Ve=(t,n,e,o)=>{const s=new Map,i={addShadowRoot:r=>{if(s.has(r))return;const u=dt(e,t,n,i,r),a=ct(t,n,e,r),c=ot(t,n,e,o,r);s.set(r,{flush:()=>u.flush(),stop:()=>{u.stop(),a.stop(),c.stop()}})},removeShadowRoot:r=>{const u=s.get(r);u&&(u.stop(),s.delete(r))},stop:()=>{s.forEach(({stop:r})=>r())},flush:()=>{s.forEach(({flush:r})=>r())}};return i};function ke(t,n,e,o,s,i,r){const u=(c,d)=>{const{width:l,height:f}=_t();r({data:{height:f,href:window.location.href,width:l},type:N.Meta,timestamp:c}),r({data:{has_focus:document.hasFocus()},type:N.Focus,timestamp:c});const p=P();r({data:{node:be(document,o,s,{status:d,elementsScrollPositions:t,serializationStats:p,shadowRootsController:n}),initialOffset:{left:J(),top:q()}},type:N.FullSnapshot,timestamp:c},p),window.visualViewport&&r({data:nt(window.visualViewport),type:N.VisualViewport,timestamp:c})};u(w(),0);const{unsubscribe:a}=e.subscribe(2,c=>{i(),u(c.startClocks.timeStamp,1)});return{stop:a}}function Pe(){const t=new WeakMap;let n=1;return{getIdForEvent(e){return t.has(e)||t.set(e,n++),t.get(e)}}}function Fe(){const t=new WeakMap;let n=1;const e=o=>t.get(o);return{assign:o=>{let s=e(o);return s===void 0&&(s=n++,t.set(o,s)),s},get:e,areAssignedForNodeAndAncestors:o=>{let s=o;for(;s;){if(e(s)===void 0&&!Z(s))return!1;s=V(s)}return!0}}}function Ue(t){const{emit:n,configuration:e,lifeCycle:o}=t;if(!n)throw new Error("emit function is required");const s=(p,g)=>{n(p,g),Dt("record",{record:p});const h=t.viewHistory.findView();At(h.id)},i=ze(),r=Ce(Fe()),u=Ve(e,r,s,i),{stop:a}=ke(i,u,o,e,r,c,s);function c(){u.flush(),l.flush()}const d=Pe(),l=dt(s,e,r,u,document),f=[l,qt(e,r,s),Jt(e,r,s,d),ot(e,r,s,i,document),Zt(e,s),ct(e,r,s),te(e,r,s),ee(r,s),ne(e,s),Qt(e,s),se(o,s,d),oe(o,p=>{c(),s(p)})];return{stop:()=>{u.stop(),f.forEach(p=>p.stop()),a()},flushMutations:c,shadowRootsController:u}}function Be(t,n,e,o){const s=new FormData;s.append("segment",new Blob([t],{type:"application/octet-stream"}),`${n.session.id}-${n.start}`);const i={raw_segment_size:o,compressed_segment_size:t.byteLength,...n},r=JSON.stringify(i);return s.append("event",new Blob([r],{type:"application/json"})),{data:s,bytesCount:t.byteLength,cssText:e.cssText,isFullSnapshot:n.index_in_view===0,rawSize:o,recordCount:n.records_count,serializationDuration:e.serializationDuration}}function He({context:t,creationReason:n,encoder:e}){let o=0;const s=t.view.id,i=Lt(s),r={start:1/0,end:-1/0,creation_reason:n,records_count:0,has_full_snapshot:!1,index_in_view:i,source:"browser",...t},u=P();Ot(s);function a(d,l,f){r.start=Math.min(r.start,d.timestamp),r.end=Math.max(r.end,d.timestamp),r.records_count+=1,r.has_full_snapshot||(r.has_full_snapshot=d.type===N.FullSnapshot),l&&fe(u,l);const p=e.isEmpty?'{"records":[':",";e.write(p+JSON.stringify(d),g=>{o+=g,f(o)})}function c(d){if(e.isEmpty)throw new Error("Empty segment flushed");e.write(`],${JSON.stringify(r).slice(1)}
`),e.finish(l=>{zt(r.view.id,l.rawBytesCount),d(r,u,l)})}return{addRecord:a,flush:c}}const Ge=5*Ft;let ft=6e4;function We(t,n,e,o,s,i){return $e(t,()=>Ye(n.applicationId,e,o),s,i)}function $e(t,n,e,o){let s={status:0,nextSegmentCreationReason:"init"};const{unsubscribe:i}=t.subscribe(2,()=>{u("view_change")}),{unsubscribe:r}=t.subscribe(11,a=>{u(a.reason)});function u(a){s.status===1&&(s.segment.flush((c,d,l)=>{const f=Be(l.output,c,d,l.rawBytesCount);Vt(a)?e.sendOnExit(f):e.send(f)}),kt(s.expirationTimeoutId)),a!=="stop"?s={status:0,nextSegmentCreationReason:a}:s={status:2}}return{addRecord:(a,c)=>{if(s.status!==2){if(s.status===0){const d=n();if(!d)return;s={status:1,segment:He({encoder:o,context:d,creationReason:s.nextSegmentCreationReason}),expirationTimeoutId:Pt(()=>{u("segment_duration_limit")},Ge)}}s.segment.addRecord(a,c,d=>{d>ft&&u("segment_bytes_limit")})}},stop:()=>{u("stop"),i(),r()}}}function Ye(t,n,e){const o=n.findTrackedSession(),s=e.findView();if(!(!o||!s))return{application:{id:t},session:{id:o.id},view:{id:s.id}}}function Xe(t,n){if(!t.metricsEnabled)return{stop:C};const{unsubscribe:e}=n.subscribe(o=>{if(o.type==="failure"||o.type==="queue-full"||o.type==="success"&&o.payload.isFullSnapshot){const s=qe(o.type,o.bandwidth,o.payload);Ut("Segment network request metrics",{metrics:s})}});return{stop:e}}function qe(t,n,e){return{cssText:{count:e.cssText.count,max:e.cssText.max,sum:e.cssText.sum},isFullSnapshot:e.isFullSnapshot,ongoingRequests:{count:n.ongoingRequestCount,totalSize:n.ongoingByteCount},recordCount:e.recordCount,result:t,serializationDuration:{count:e.serializationDuration.count,max:e.serializationDuration.max,sum:e.serializationDuration.sum},size:{compressed:e.bytesCount,raw:e.rawSize}}}function Je(t){const n=Bt();return{addRecord:e=>{const o=t.findView();n.send("record",e,o.id)}}}function je(t,n,e,o,s,i,r){const u=[],a=f=>{t.notify(14,{error:f}),Wt("Error reported to customer",{"error.message":f.message})},c=r||Ht([n.sessionReplayEndpointBuilder],a,ft);let d;if(Gt())({addRecord:d}=Je(o));else{const f=We(t,n,e,o,c,s);d=f.addRecord,u.push(f.stop);const p=Xe(i,c.observable);u.push(p.stop)}const{stop:l}=Ue({emit:d,configuration:n,lifeCycle:t,viewHistory:o});return u.push(l),{stop:()=>{u.forEach(f=>f())}}}export{je as startRecording};
//# sourceMappingURL=startRecording-CiCa3x88.js.map
